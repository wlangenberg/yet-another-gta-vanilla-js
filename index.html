<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <style>
            body {
                margin: 0;
                padding: 0;
            }
            canvas {
                width: 100%;
                height: 100%;
                background-color: green;
                display: block;
                position: relative;
            } 
            .platform {
                background-color: blue;
                position: absolute;
            }
            .character {
                background-color: white;
                position: absolute;
            }
        </style>
    </head>
    <body>
        <canvas></canvas>
    </body>
    <script> 
        const canvas = document.querySelector('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const keys = [];


        class Player {
            constructor(x, y, width, height, color) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.dy = 0;
                this.jumpForce = 10;
                this.maxSpeed = 25;
                this.friction = 0.82;
                this.speed = 0;
                this.direction = 0;
                this.acceleration = 2.7;
                this.originalHeight = height;
                this.grounded = false;
                this.jumpTimer = 0;
            }

            animate() {
                this.dy += 0.8;
                this.y += this.dy;
                if (this.grounded) this.speed *= this.friction;

                this.x += this.speed * this.direction;

                // Check for jump time
                if (this.jumpTimer > 0) {
                    this.jumpTimer--;
                    this.dy = -this.jumpForce;
                }

                // Check for ground
                if (this.y + this.height > canvas.height - 100) {
                    this.y = canvas.height - this.height - 100;
                    this.grounded = true;
                    this.dy = 0;
                }

                this.draw();
                <!-- console.log("SPEED:", this.speed, this.direction); -->
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }

            move() {
                if (keys['ArrowRight']) {
                    if (this.speed > 1 && this.direction === -1) {
                        this.speed -= this.acceleration/4;
                        this.speed = Math.max(0, this.speed);
                        return;
                    }
                    if (this.grounded) {
                        this.direction = 1;
                        this.speed += this.acceleration;
                        this.speed = Math.min(this.maxSpeed, this.speed);
                    }
                }
                if (keys['ArrowLeft']) {
                    if (this.speed > 1 && this.direction === 1) {
                        this.speed -= this.acceleration/4;
                        this.speed = Math.max(0, this.speed);
                        return;
                    } 
                    if (this.grounded) {
                        this.direction = -1;
                        this.speed += this.acceleration;
                        this.speed = Math.min(this.maxSpeed, this.speed);
                    }

                }
                if (keys['ArrowUp'] && this.grounded) {
                    this.jumpTimer = 12;
                    this.y -= 10;
                    this.grounded = false;
                }
            }
        }

        class Platform {
            constructor(x, y, width, height, color) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        const player = new Player(20, 20, 50, 50, 'white');
        const platform = new Platform(0, canvas.height - 100, canvas.width, 100, 'blue');
        player.draw();
        platform.draw();
        const fps = 60;
        const interval = 1000 / fps;
        let lastTime = 0;

        const tick = (timestamp) => {
            if (timestamp - lastTime >= interval) {
                lastTime = timestamp;
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                player.animate();
                player.move();
                platform.draw();
            }

            requestAnimationFrame(tick);
        };

        tick(0);


        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
        });

        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
    </script>
</html>
